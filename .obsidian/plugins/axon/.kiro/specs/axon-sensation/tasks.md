# Implementation Plan

- [x] 1. Set up project structure and TypeScript configuration
  - Create `src/core/file-analyzer.ts` for analysis logic
  - Create `src/core/file-context.ts` for file change detection
  - Create `src/core/types.ts` with all interface definitions
  - Update `src/ui/insight-card.ts` for result display
  - _Requirements: 1.1, 2.1-2.5, 3.1-3.4_

- [x] 2. Implement core data types and interfaces
  - [x] 2.1 Define FileAnalysisResult, HeadingInfo, LinkInfo, FrontmatterData interfaces in types.ts
    - Add all required fields as specified in design document
    - Export interfaces for use across modules
    - _Requirements: 2.1-2.5, 3.2_

- [x] 3. Implement FileAnalyzer module
  - [x] 3.1 Implement heading extraction function
    - Parse markdown content for H1-H6 headings using regex
    - Return array of HeadingInfo with level, text, and position
    - _Requirements: 2.1_
  - [x] 3.2 Write property test for heading extraction
    - **Property 2: Heading Extraction Accuracy**
    - **Validates: Requirements 2.1**
  - [x] 3.3 Implement word count function
    - Count whitespace-separated tokens
    - Exclude markdown syntax from count
    - _Requirements: 2.2_
  - [x] 3.4 Write property test for word count
    - **Property 3: Word Count Consistency**
    - **Validates: Requirements 2.2**
  - [x] 3.5 Implement link extraction function
    - Extract wiki-style [[links]] using regex
    - Extract external URLs using URL pattern matching
    - Return LinkInfo with arrays and counts
    - _Requirements: 2.3, 2.4_
  - [x] 3.6 Write property test for link extraction
    - **Property 4: Link Extraction Completeness**
    - **Validates: Requirements 2.3, 2.4**
  - [x] 3.7 Implement frontmatter parsing function
    - Use Obsidian MetadataCache for frontmatter access
    - Handle malformed frontmatter gracefully (return null)
    - _Requirements: 2.5, 5.2_
  - [x] 3.8 Write property test for frontmatter parsing
    - **Property 5: Frontmatter Parsing Round-Trip**
    - **Validates: Requirements 2.5, 5.2**
  - [x] 3.9 Implement main analyzeFile function
    - Combine all extraction functions
    - Return complete FileAnalysisResult
    - Handle errors gracefully
    - _Requirements: 1.1, 2.1-2.5_
  - [x] 3.10 Write property test for file retrieval validation
    - **Property 1: File Retrieval Validation**
    - **Validates: Requirements 1.1, 1.2, 1.3**

- [x] 4. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 5. Implement FileContext module
  - [x] 5.1 Create FileContext class with currentFile tracking
    - Store reference to current active file
    - Provide getter for current file state
    - _Requirements: 4.1, 4.2_
  - [x] 5.2 Implement file change detection using Obsidian workspace events
    - Register for 'active-leaf-change' event
    - Filter for MarkdownView changes only
    - _Requirements: 4.1_
  - [x] 5.3 Implement callback system for file change notifications
    - Allow registering callbacks for file changes
    - Emit events through EventBus
    - _Requirements: 4.2, 4.3_
  - [x] 5.4 Write property test for file context update
    - **Property 8: File Context Update on Change**
    - **Validates: Requirements 4.1, 4.2, 4.3**

- [x] 6. Implement InsightCard UI component
  - [x] 6.1 Create InsightCard class with render method
    - Accept FileAnalysisResult as input
    - Create DOM structure for card display
    - _Requirements: 3.1, 3.2_
  - [x] 6.2 Implement file info section (name, path, last modified)
    - Display file name prominently
    - Show file path and modification time
    - _Requirements: 3.2_
  - [x] 6.3 Implement stats section (word count, heading count, link counts)
    - Display counts in clear visual format
    - Use icons or labels for each stat type
    - _Requirements: 3.2_
  - [x] 6.4 Implement frontmatter display section
    - Show tags, date, title if present
    - Handle missing frontmatter gracefully
    - _Requirements: 3.4_
  - [x] 6.5 Implement collapsible heading tree display
    - Show headings in hierarchical tree structure
    - Allow expand/collapse interaction
    - _Requirements: 3.5_
  - [x] 6.6 Write property test for Insight Card data completeness
    - **Property 6: Insight Card Data Completeness**
    - **Validates: Requirements 3.1, 3.2**
  - [x] 6.7 Write property test for frontmatter display
    - **Property 7: Frontmatter Display in Card**
    - **Validates: Requirements 3.4**

- [x] 7. Integrate components into AxonView
  - [x] 7.1 Instantiate FileAnalyzer and FileContext in AxonView constructor
    - Create instances with proper dependencies
    - Pass app reference for Obsidian API access
    - _Requirements: 1.1, 4.1_
  - [x] 7.2 Update analyze event handler to use FileAnalyzer
    - Call analyzeFile on button click
    - Handle success and error cases
    - _Requirements: 1.1, 1.2, 1.3_
  - [x] 7.3 Update ConsoleOutput to render InsightCard
    - Add addInsightCard method
    - Style card appropriately in console
    - _Requirements: 3.1_
  - [x] 7.4 Wire up FileContext for file change notifications
    - Start watching on view open
    - Stop watching on view close
    - Display notification on file change
    - _Requirements: 4.1, 4.2, 4.3_

- [x] 8. Implement error handling
  - [x] 8.1 Add error handling for no active file case
    - Check for null active file
    - Display user-friendly message
    - _Requirements: 1.2, 5.4_
  - [x] 8.2 Add error handling for non-Markdown files
    - Check file extension
    - Display appropriate message
    - _Requirements: 1.3, 5.4_
  - [x] 8.3 Add error handling for empty files
    - Detect empty content
    - Show InsightCard with zero counts and indicator
    - _Requirements: 5.1_
  - [x] 8.4 Add general error handling wrapper
    - Catch unexpected errors
    - Display friendly message, log details
    - _Requirements: 5.4_
  - [x] 8.5 Write property test for error handling
    - **Property 9: Error Handling Graceful Degradation**
    - **Validates: Requirements 5.4**

- [x] 9. Update styles for InsightCard
  - Add CSS styles for insight card layout
  - Style stats display with visual hierarchy
  - Style collapsible heading tree
  - Ensure consistent look with existing Axon UI
  - _Requirements: 3.3_

- [x] 10. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.
